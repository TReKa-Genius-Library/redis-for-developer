# 230107

### MSA와 RDBMS

 **최근, 모놀로틱 구조의 유지보수 복잡도 및 변경의 유연성 난이도로 인해 MSA가 각광**받고 있습니다. 책에 언급된대로 서비스 분리로 인해 관리 복잡도로 인한 운영 부담, 성능 저하 가능성의 단점이 존재하지만, 변경의 유연성과 모듈 및 서비스 관리 용이성이라는 장점으로 인해 많이 사랑받고 있는 것으로 보입니다. 실제로 사내에서도 MSA 아키텍처를 이용하고 있습니다. 각 팀마다 최소 1개 이상의 서비스를 운영하고 있으며, 제가 속한 팀에는 2개의 서비스를 관리하고 있습니다.

 MSA 환경에서, 그리고 최근 서비스에서는 애플리케이션 복잡성이 매우 커져서 관계간의 복잡성으로 인해 쿼리 성능이 저하되는 문제가 발생할 수 있습니다. 실제로 쿼리 실행계획을 살피고 인덱스 및 테이블 구조를 최적화하는 등의 리팩터링을 많이 진행하는 것 같습니다. 또, 비정형 데이터가 예전에 비해 빈번하게 증가하고 있습니다. 이러한 이슈들로 인해 RDBMS 뿐 아니라 NoSQL도 사랑받고 있습니다. 책에서는 아래와 같은 장점들을 소개해주고 있습니다.

- 실시간 응답
- 확장성
- 고가용성
- 클라우드 네이티브
- 단순성
- 유연성

책에서 NoSQL에는 아래 두 가지 유형을 소개해주고 있습니다.

Q. 혹시 두 가지 유형 외에 다른 유형이 추가로 있는지도 궁금하네요.

- 문서 유형 (Json 형태로 데이터 저장)
    - mongoDB, DocumentDB
- key-value 유형
    - Elasticache, DynamoDB

### 레디스 특징

- In-Memory DB

 보통의 DB는 온디스크(disk-based) 형태입니다. 온디스크 형태의 DB에선 디스크에서 페이지를 가져와 메모리에 올린 뒤, 데이터를 찾는 방식으로 진행된다고 합니다. **이 방식은 HDD, SSD와 같은 디스크에 접근하므로 RAM과 같은 메모리에 접속하는 것보다 현저히 느립니다. (대신 영구적으로 저장이 가능합니다.) 하지만 Redis는 메모리에 저장되므로 빠른 성능을 자랑**합니다.

 레디스는 키에 매핑되는 값으로 string 형태뿐 아니라 hash, set 등 다양한 자료구조를 지원합니다. 이 덕분에 **별도의 추가적인 데이터 가공이 필요 없으며, 임피던스 불일치(프로그래밍 언어 간 데이터 구조, 기능의 차이로 인해 발생하는 충돌)를 해소**할 수 있습니다.

 레디스는 **싱글 스레드로 동작**합니다. 따라서 하나의 코어만 있어도 배포가 쉬우며, CPU가 적은 서버에서도 좋은 성능을 낼 수 있습니다. 또한 동기화나 락이 없어도 안정적입니다. 하지만, **blocking으로 인한 장애가 발생할 수 있습니다**. 

레디스는 HA 기능을 제공하여 여러 서버에 데이터를 분산시킬 수 있고, failover 기능을 제공해줍니다. 이로 인해 장애 발생 시 유연한 대처가 가능하며, 손쉬운 수평 확장이 가능합니다. 

### MSA와 레디스

(여기서는 요약 대신 새롭게 알게되거나, 키워드 중심으로 정리하겠습니다.)

- 레디스의 도입을 고민할 때 데이터의 영속성을 고민할 수 있으나, 레디스의 데이터는 AOF(Append Only File)와 RDB(Redis Database) 형식으로 디스크에 주기적으로 저장할 수 있다. 레디스에 장애가 발생해 데이터가 유실되더라도 백업 파일을 이용하면 다시 복구할 수 있다.

레디스 내에서 자체적으로 주기적으로 폴링해주는 기능이 있는건가? 궁금해서 기록해보았습니다.

백업 파일 복구 방법이 문득 궁금해져서 기록해보았습니다.

- 레디스의 pub/sub 기능

실제로 우아한테크코스에서 진행했던 프로젝트에 redis pub/sub을 이용해 알림 기능을 팀원분이 제작해주셨는데요, fire-and-forget 이 요구되는 요구사항이었어서 kafka 대신 redis pub/sub 을 이용했습니다. 이에 대해 얘기 나눠보는 것도 재밌을 거 같아 기록해보았습니다.
