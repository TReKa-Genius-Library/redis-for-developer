### 레디스 복제 구조
- MySQL, postgreSQL과 다르게 멀티 마스터 구조 지원하지 않음.
  - 마스터는 복제본이 될 수 없음.
  - **한 개의 복제 그룹에는 항상 한 개의 마스터 노드만 존재**
  - **복제본 노드에 새로운 복제본 추가 가능**
  - 복제본 노드는 읽기 전용으로 동작
    - 단, `replica-read-only` 설정을 해제하면 쓰기 작업가능.
      - 복제본 노드 데이터가 변경되더라도 재시작 및 전체 재동기화 수행 시, 복제본 수행 데이터 유실됨. (자신의 복제본으로도 전달되지 않음.)  


### 복제 구조 구성
`REPLICAOF <master-ip> <master-port>`

### 복제 매커니즘
- 버전 7 이전: 복제 과정에서 복제 속도는 디스크 i/o 처리량에 영향을 받음.
- 버전 7 이후: `repl-diskless-sync` 기본값 yes
  - 소켓에서 읽어오는 RDB 스냅샷 데이터를 메모리에 바로 로드하는 것이 아닌, 복제본 노드의 디스크에 저장
  - disk i/o 가 느리고 네트워크가 빠른 경우에 유용한 방법
    - 그렇지 않은 경우 repl-diskless 한 방법이 아닌, 원래 방법 이용하면 될 듯.
   
### 비동기 복제연결
- 마스터 -> 복제본 데이터 전달은 비동기적으로.
  - 전달 속도가 매우 빨라 데이터의 유실이 거의 발생하진 않지만, 비정상적으로 종료됐을 때 데이터 유실이 존재할 가능성 존재.
    - **replication id와 오프셋이 같을 때 마스터노드와 복제본 노드의 복제 데이터 일치한 것을 확인 가능** 
    - 🙋🏻‍♂️ 그렇다면 복제본으로 데이터 전달 유실이 발생한 케이슨 어떻게 해야 할까? 전체 재동기화 기능, 부분 재동기화 기능을 진행할 것 같음. 그런데 복제본이 데이터 전달 유실이 발생했다는 것을 어떻게 지각할 수 있지?
    - 
   
### 부분 재동기화
- 네트워크가 불안정한 경우, 마스터에서 RDB 파일을 새로 내려 복제본에 전달하는 과정으로 복제될 때 레디스 성능 저하 가능 -> 부분 재동기화 기능 사용
- 마스터: 백로그 버퍼에 복제본에 전달할 커맨드 데이터 저장
  - 복제본은 `PSYNC` 커맨드로 자신의 replication id와 오프셋을 마스터에 전달, 마스터 노드에 재연결을 통해 불일치하는 오프셋 데이터들을 추가로 받아옴 (마스터는 RDB 파일을 새로 저장할 필요 없이 전달해주기만 하면 됨.)
  - 복제본은 언제든지 마스터로 승격 가능하므로, 백로그 버퍼를 해제하지 않음.
