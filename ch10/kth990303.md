## 클러스터
### Scale-Up vs Scale-Out
- 레디스 서버 instance 스케일업을 한다고 해도, CPU 단일코어 (싱글 스레드 기반 레디스) 사용으로 인해 한계가 존재
  - 스케일아웃을 통한 클러스터링 작업 필요
 
### 클러스터 기능
- 샤딩: 여러 서버 간에 데이터를 분할
  - 마스터 최대 1,000개까지 확장 가능
  - 샤딩과 관련된 모든 기능은 **레디스 내부에서 자체적으로 관리**됨. 프록시 서버 등 추가 아키텍처 불필요
  - 클라이언트 측에서 특정 키 정보 캐싱 -> 키 찾아오는 시간 단축
- 고가용성
  - 각 노드는 TCP ping-pong 연결로 서로를 모니터링
    - 가십 프로토콜, 구성 업데이트 매커니즘으로 메시지 오버헤드 미발생
    - 
### 레디스 클러스터 마이그레이션
- 지마켓 기술블로그: https://dev.gmarket.com/71
  
### 레디스 클러스터 동작 방법  
- 하트비트 패킷
  - 해당 패킷을 받은 노드는 다른 노드에 대한 정보를 얻을 수 있게 되고, 장애도 감지할 수 있게 됨.
  - ping/pong 시 에포크 값 증가.
    - 클러스터 상태 변경 및 페일오버 발생 시 동의를 구하기 위해 사용됨.
  - kubernates 등 다양한 고가용성 서비스에서 하트비트 개념이 이용되는 듯 함. 구글링 시 논문도 굉장히 많이 나옴.
    - 참고: https://computing-jhson.tistory.com/123
  
- 리디렉션 
  - MOVED: 요청 노드 옮겨버림
    - 해시슬롯이 있는 노드로 변경 및 클라이언트에서 기억하여 SPOF가 발생하지 않도록 
  - ASK: 요청 노드 일시적으로 해당 노드에서 수행
    - 해시슬롯 맵 업데이트하지 않음.
    - 클러스터 리샤딩 및 레디스 마이그레이션 등으로 인해 해시슬롯 이동될 때 해당 리디렉션 발생할 것으로 보임.  
   
- 장애 감지 및 failover
  - PFAIL: ping 패킷 후 node_timeout을 초과하여 pong 패킷을 받지 못한 상황
  - FAIL: PFAIL 플래깅 이후 하트비트 패킷을 통해 B 노드에 대한 PFAIL, FAIL 알림을 받는 경우 
